<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ROSOIDEAE ‚Äî Staff Portal</title>
  <meta name="description" content="ROSOIDEAE internal staff portal for questionnaires, team checkups, admin reviews, and staff applications." />
  <style>
    :root {
      --deep-night: #0a0a0f;
      --roso-purple: #3A3A4A;
      --crimson-edge: #7C3AED;
      --blood-moon: #5B21B6;
      --text-primary: #E2E2E8;
      --text-muted: #8B8B9A;
      --surface: #14141a;
      --surface-alt: #1a1a24;
      --surface-hover: #1e1e2a;
      --border: #2a2a3a;
      --success: #22C55E;
      --warning: #F59E0B;
      --danger: #EF4444;
      --info: #3B82F6;
      --input-bg: #0e0e14;
      --glow: rgba(124, 58, 237, 0.15);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--deep-night);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideIn { from { opacity: 0; transform: translateX(-12px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    .site-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 2rem; height: 64px;
      background: rgba(10, 10, 15, 0.85); backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      position: sticky; top: 0; z-index: 100;
    }
    .logo-area { display: flex; align-items: center; gap: 0.75rem; cursor: pointer; }
    .logo-icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--crimson-edge), var(--blood-moon)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }
    .logo-text { font-size: 1.15rem; font-weight: 700; letter-spacing: 0.04em; background: linear-gradient(90deg, #fff, #A78BFA); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .nav-links { display: flex; gap: 0.25rem; align-items: center; }
    .nav-btn {
      background: transparent; color: var(--text-muted); border: none;
      padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;
      font-size: 0.875rem; font-weight: 500; transition: all 0.2s;
      position: relative;
    }
    .nav-btn:hover { color: var(--text-primary); background: var(--surface); }
    .nav-btn.active { color: var(--text-primary); background: var(--surface-alt); }
    .nav-btn.active::after { content: ''; position: absolute; bottom: -1px; left: 50%; transform: translateX(-50%); width: 20px; height: 2px; background: var(--crimson-edge); border-radius: 1px; }

    /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
    .app-container { max-width: 1100px; margin: 0 auto; padding: 2rem; }
    .hidden { display: none !important; }

    /* ‚îÄ‚îÄ Dashboard ‚îÄ‚îÄ */
    .dash-hero { margin-bottom: 2.5rem; animation: fadeIn 0.4s ease; }
    .dash-hero h1 { font-size: 1.75rem; font-weight: 700; margin-bottom: 0.25rem; }
    .dash-hero p { color: var(--text-muted); font-size: 0.95rem; }
    .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1.5rem 0 2rem; }
    .stat-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
      padding: 1.25rem; transition: border-color 0.2s;
    }
    .stat-card:hover { border-color: var(--crimson-edge); }
    .stat-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 0.5rem; }
    .stat-value { font-size: 1.75rem; font-weight: 700; }
    .stat-value.purple { color: #A78BFA; }
    .stat-value.green { color: var(--success); }
    .stat-value.amber { color: var(--warning); }
    .stat-value.blue { color: var(--info); }

    .section-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
    .section-title .badge { font-size: 0.7rem; background: var(--crimson-edge); color: #fff; padding: 0.15rem 0.5rem; border-radius: 10px; font-weight: 600; }

    /* ‚îÄ‚îÄ Form Cards ‚îÄ‚îÄ */
    .form-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
    .form-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: 14px;
      padding: 1.5rem; cursor: pointer; transition: all 0.25s; position: relative; overflow: hidden;
      animation: fadeIn 0.4s ease backwards;
    }
    .form-card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
      background: linear-gradient(90deg, var(--crimson-edge), var(--blood-moon));
      opacity: 0; transition: opacity 0.25s;
    }
    .form-card:hover { border-color: var(--crimson-edge); transform: translateY(-3px); box-shadow: 0 8px 30px var(--glow); }
    .form-card:hover::before { opacity: 1; }
    .form-card .fc-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; margin-bottom: 1rem; }
    .fc-icon.checkup { background: rgba(124, 58, 237, 0.15); }
    .fc-icon.application { background: rgba(34, 197, 94, 0.15); }
    .fc-icon.admin { background: rgba(245, 158, 11, 0.15); }
    .fc-icon.survey { background: rgba(59, 130, 246, 0.15); }
    .form-card h3 { font-size: 1rem; font-weight: 600; margin-bottom: 0.35rem; }
    .form-card .fc-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem; line-height: 1.5; }
    .fc-footer { display: flex; align-items: center; justify-content: space-between; }
    .fc-tag { font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.04em; }
    .fc-tag.checkup { background: rgba(124, 58, 237, 0.15); color: #A78BFA; }
    .fc-tag.application { background: rgba(34, 197, 94, 0.15); color: var(--success); }
    .fc-tag.admin { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
    .fc-tag.survey { background: rgba(59, 130, 246, 0.15); color: var(--info); }
    .fc-questions { font-size: 0.8rem; color: var(--text-muted); }

    /* ‚îÄ‚îÄ Form Fill View ‚îÄ‚îÄ */
    .fill-header { margin-bottom: 2rem; animation: fadeIn 0.3s ease; }
    .fill-header h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.25rem; }
    .fill-header .fill-desc { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.75rem; }
    .fill-meta { display: flex; gap: 1rem; flex-wrap: wrap; }
    .fill-meta-item { font-size: 0.8rem; color: var(--text-muted); display: flex; align-items: center; gap: 0.3rem; }
    .question-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
      padding: 1.5rem; margin-bottom: 1rem; animation: fadeIn 0.4s ease backwards;
    }
    .question-card .q-number { font-size: 0.7rem; color: var(--crimson-edge); text-transform: uppercase; letter-spacing: 0.06em; font-weight: 700; margin-bottom: 0.5rem; }
    .question-card .q-text { font-size: 1rem; font-weight: 500; margin-bottom: 1rem; }
    .question-card .q-hint { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.75rem; font-style: italic; }
    .q-required { color: var(--danger); margin-left: 0.25rem; }

    /* ‚îÄ‚îÄ Input Styles ‚îÄ‚îÄ */
    .form-input, .form-textarea {
      width: 100%; background: var(--input-bg); color: var(--text-primary);
      border: 1px solid var(--border); border-radius: 10px;
      padding: 0.75rem 1rem; font-size: 0.9rem; font-family: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .form-input:focus, .form-textarea:focus { outline: none; border-color: var(--crimson-edge); box-shadow: 0 0 0 3px var(--glow); }
    .form-textarea { min-height: 100px; resize: vertical; }

    /* ‚îÄ‚îÄ Choice Options ‚îÄ‚îÄ */
    .choice-group { display: flex; flex-direction: column; gap: 0.5rem; }
    .choice-option {
      display: flex; align-items: center; gap: 0.75rem;
      background: var(--input-bg); border: 1px solid var(--border); border-radius: 10px;
      padding: 0.75rem 1rem; cursor: pointer; transition: all 0.2s;
    }
    .choice-option:hover { border-color: var(--roso-purple); background: var(--surface-hover); }
    .choice-option.selected { border-color: var(--crimson-edge); background: rgba(124, 58, 237, 0.08); }
    .choice-radio { width: 18px; height: 18px; border-radius: 50%; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: border-color 0.2s; }
    .choice-option.selected .choice-radio { border-color: var(--crimson-edge); }
    .choice-option.selected .choice-radio::after { content: ''; width: 8px; height: 8px; border-radius: 50%; background: var(--crimson-edge); }
    .choice-label { font-size: 0.9rem; }

    /* ‚îÄ‚îÄ Rating ‚îÄ‚îÄ */
    .rating-group { display: flex; gap: 0.5rem; }
    .rating-btn {
      width: 44px; height: 44px; border-radius: 10px; border: 1px solid var(--border);
      background: var(--input-bg); color: var(--text-muted); font-size: 1rem; font-weight: 600;
      cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center;
    }
    .rating-btn:hover { border-color: var(--roso-purple); color: var(--text-primary); }
    .rating-btn.selected { border-color: var(--crimson-edge); background: rgba(124, 58, 237, 0.15); color: #A78BFA; }

    /* ‚îÄ‚îÄ Yes/No Toggle ‚îÄ‚îÄ */
    .yesno-group { display: flex; gap: 0.75rem; }
    .yesno-btn {
      flex: 1; max-width: 160px; padding: 0.75rem 1.5rem; border-radius: 10px;
      border: 1px solid var(--border); background: var(--input-bg);
      color: var(--text-muted); font-size: 0.9rem; font-weight: 600; cursor: pointer;
      transition: all 0.2s; text-align: center;
    }
    .yesno-btn:hover { border-color: var(--roso-purple); }
    .yesno-btn.selected-yes { border-color: var(--success); background: rgba(34, 197, 94, 0.1); color: var(--success); }
    .yesno-btn.selected-no { border-color: var(--danger); background: rgba(239, 68, 68, 0.1); color: var(--danger); }

    /* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ */
    .btn {
      display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
      padding: 0.7rem 1.5rem; border: none; border-radius: 10px; cursor: pointer;
      font-size: 0.9rem; font-weight: 600; transition: all 0.2s; font-family: inherit;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn-primary { background: linear-gradient(135deg, var(--crimson-edge), var(--blood-moon)); color: #fff; box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3); }
    .btn-primary:hover { box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4); }
    .btn-secondary { background: var(--surface); border: 1px solid var(--border); color: var(--text-primary); }
    .btn-secondary:hover { border-color: var(--roso-purple); }
    .btn-ghost { background: transparent; color: #A78BFA; padding: 0.5rem 0; }
    .btn-ghost:hover { color: var(--text-primary); }
    .form-actions { display: flex; gap: 0.75rem; margin-top: 1.5rem; }

    .back-btn { background: none; border: none; color: #A78BFA; cursor: pointer; font-size: 0.9rem; margin-bottom: 1.5rem; padding: 0; display: flex; align-items: center; gap: 0.3rem; font-family: inherit; }
    .back-btn:hover { color: var(--text-primary); }

    /* ‚îÄ‚îÄ Submissions Table ‚îÄ‚îÄ */
    .submissions-list { display: flex; flex-direction: column; gap: 0.75rem; }
    .submission-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
      padding: 1.25rem 1.5rem; cursor: pointer; transition: all 0.2s;
      display: flex; align-items: center; justify-content: space-between; gap: 1rem;
      animation: fadeIn 0.3s ease backwards;
    }
    .submission-card:hover { border-color: var(--crimson-edge); transform: translateY(-1px); }
    .sub-info { flex: 1; min-width: 0; }
    .sub-form-name { font-size: 0.95rem; font-weight: 600; margin-bottom: 0.2rem; }
    .sub-meta { font-size: 0.8rem; color: var(--text-muted); display: flex; gap: 0.75rem; flex-wrap: wrap; }
    .sub-status { font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.04em; white-space: nowrap; }
    .sub-status.completed { background: rgba(34, 197, 94, 0.15); color: var(--success); }
    .sub-status.pending { background: rgba(245, 158, 11, 0.15); color: var(--warning); }

    /* ‚îÄ‚îÄ Submission Detail View ‚îÄ‚îÄ */
    .answer-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
      padding: 1.25rem; margin-bottom: 0.75rem;
    }
    .answer-card .a-question { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.35rem; }
    .answer-card .a-value { font-size: 0.95rem; font-weight: 500; }

    /* ‚îÄ‚îÄ Progress Bar ‚îÄ‚îÄ */
    .progress-bar-container { margin-bottom: 1.5rem; }
    .progress-info { display: flex; justify-content: space-between; margin-bottom: 0.4rem; }
    .progress-info span { font-size: 0.8rem; color: var(--text-muted); }
    .progress-track { width: 100%; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--crimson-edge), #A78BFA); border-radius: 3px; transition: width 0.4s ease; }

    /* ‚îÄ‚îÄ Empty State ‚îÄ‚îÄ */
    .empty-state { text-align: center; padding: 4rem 1rem; color: var(--text-muted); }
    .empty-state .empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }
    .empty-state p { margin-bottom: 1rem; font-size: 0.95rem; }

    /* ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ */
    .tab-bar { display: flex; gap: 0.25rem; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 0; }
    .tab-btn {
      background: transparent; color: var(--text-muted); border: none; border-bottom: 2px solid transparent;
      padding: 0.6rem 1rem; cursor: pointer; font-size: 0.875rem; font-weight: 500;
      transition: all 0.2s; font-family: inherit; margin-bottom: -1px;
    }
    .tab-btn:hover { color: var(--text-primary); }
    .tab-btn.active { color: var(--text-primary); border-bottom-color: var(--crimson-edge); }

    /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
    .toast {
      position: fixed; bottom: 2rem; right: 2rem; background: var(--surface-alt);
      border: 1px solid var(--border); border-radius: 12px; padding: 1rem 1.5rem;
      color: var(--text-primary); font-size: 0.9rem; z-index: 200;
      animation: fadeIn 0.3s ease; box-shadow: 0 10px 40px rgba(0,0,0,0.4);
      display: flex; align-items: center; gap: 0.75rem;
    }
    .toast.success { border-left: 3px solid var(--success); }

    /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
    @media (max-width: 700px) {
      .app-container { padding: 1rem; }
      .site-header { padding: 0 1rem; }
      .stats-row { grid-template-columns: repeat(2, 1fr); }
      .form-grid { grid-template-columns: 1fr; }
      .dash-hero h1 { font-size: 1.35rem; }
    }
    footer { text-align: center; padding: 2.5rem 1rem; color: var(--text-muted); font-size: 0.8rem; border-top: 1px solid var(--border); margin-top: 3rem; }
    .built-by-star {
      color: #A855F7; text-decoration: none; font-weight: 600;
      text-shadow: 0 0 10px rgba(168, 85, 247, 0.5), 0 0 25px rgba(168, 85, 247, 0.25);
      animation: starGlow 3s ease-in-out infinite; transition: all 0.3s;
    }
    .built-by-star:hover { color: #C084FC; text-shadow: 0 0 15px rgba(168, 85, 247, 0.7), 0 0 35px rgba(168, 85, 247, 0.4); }
    @keyframes starGlow {
      0%, 100% { text-shadow: 0 0 10px rgba(168, 85, 247, 0.5), 0 0 25px rgba(168, 85, 247, 0.25); }
      50% { text-shadow: 0 0 18px rgba(168, 85, 247, 0.7), 0 0 40px rgba(168, 85, 247, 0.4); }
    }

    /* ‚îÄ‚îÄ Access Level Modal ‚îÄ‚îÄ */
    .access-modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); backdrop-filter: blur(8px);
      z-index: 300; display: flex; align-items: center; justify-content: center;
    }
    .access-modal {
      background: var(--surface); border: 1px solid var(--border); border-radius: 16px;
      padding: 2.5rem; max-width: 420px; width: 90%; text-align: center;
      animation: fadeIn 0.3s ease;
    }
    .access-modal h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 0.5rem; }
    .access-modal p { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1.5rem; }
    .access-roles { display: flex; flex-direction: column; gap: 0.75rem; }
    .role-btn {
      display: flex; align-items: center; gap: 0.75rem;
      padding: 1rem 1.25rem; border-radius: 12px; cursor: pointer;
      border: 1px solid var(--border); background: var(--input-bg);
      color: var(--text-primary); font-size: 0.95rem; font-weight: 500;
      transition: all 0.2s; text-align: left; font-family: inherit;
    }
    .role-btn:hover { border-color: var(--crimson-edge); transform: translateY(-2px); box-shadow: 0 4px 15px var(--glow); }
    .role-icon { font-size: 1.3rem; }
    .role-info { flex: 1; }
    .role-info .role-name { font-weight: 600; }
    .role-info .role-desc { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.15rem; }
  </style>
</head>
<body>

  <!-- ‚îÄ‚îÄ Header ‚îÄ‚îÄ -->
  <header class="site-header">
    <div class="logo-area" onclick="navigateTo('dashboard')">
      <div class="logo-icon">üåπ</div>
      <span class="logo-text">ROSOIDEAE</span>
    </div>
    <nav class="nav-links">
      <button class="nav-btn active" id="nav-dashboard" onclick="navigateTo('dashboard')">Dashboard</button>
      <button class="nav-btn" id="nav-forms" onclick="navigateTo('forms')">Forms</button>
      <button class="nav-btn" id="nav-applications" onclick="navigateTo('applications')">Applications</button>
      <button class="nav-btn" id="nav-submissions" onclick="navigateTo('submissions')">Submissions</button>
    </nav>
  </header>

  <div class="app-container">

    <!-- ‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-dashboard">
      <div class="dash-hero">
        <h1>Welcome back</h1>
        <p>Staff portal ‚Äî answer questionnaires, complete checkups, and submit applications.</p>
      </div>
      <div class="stats-row" id="dash-stats"></div>
      <div class="section-title">Available Forms <span class="badge" id="dash-form-count">0</span></div>
      <div class="form-grid" id="dash-forms"></div>
      <div class="section-title" style="margin-top:1rem;">Recent Submissions</div>
      <div id="dash-recent-subs"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê FORMS LIST ‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-forms" class="hidden">
      <div class="dash-hero">
        <h1>Questionnaires & Checkups</h1>
        <p>Pre-built forms for team checkups, admin reviews, and internal surveys.</p>
      </div>
      <div class="tab-bar" id="forms-tabs"></div>
      <div class="form-grid" id="forms-list"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê APPLICATIONS ‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-applications" class="hidden">
      <div class="dash-hero">
        <h1>Staff Applications</h1>
        <p>Apply for open staff positions or submit role-specific applications.</p>
      </div>
      <div class="form-grid" id="applications-list"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê FILL FORM ‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-fill" class="hidden">
      <button class="back-btn" onclick="goBackFromFill()">‚Üê Back</button>
      <div class="fill-header" id="fill-header"></div>
      <div class="progress-bar-container" id="fill-progress"></div>
      <div id="fill-questions"></div>
      <div class="form-actions" id="fill-actions"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê SUBMISSIONS ‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-submissions" class="hidden">
      <div class="dash-hero">
        <h1>My Submissions</h1>
        <p>Review your completed questionnaires and application responses.</p>
      </div>
      <div class="tab-bar" id="subs-tabs"></div>
      <div id="subs-list"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê SUBMISSION DETAIL ‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-sub-detail" class="hidden">
      <button class="back-btn" onclick="navigateTo('submissions')">‚Üê Back to submissions</button>
      <div id="sub-detail-content"></div>
    </div>

  </div>

  <footer>Staff Portal ¬∑ <a href="built-by-star.html" class="built-by-star">‚≠ê Built by Star</a></footer>

  <!-- ‚îÄ‚îÄ Access Level Modal ‚îÄ‚îÄ -->
  <div class="access-modal-overlay" id="access-modal">
    <div class="access-modal">
      <h2>Select Access Level</h2>
      <p>Choose your role to access the appropriate portal content.</p>
      <div class="access-roles">
        <button class="role-btn" onclick="setAccessLevel('public')">
          <span class="role-icon">üë§</span>
          <div class="role-info"><div class="role-name">Public</div><div class="role-desc">View and submit staff applications</div></div>
        </button>
        <button class="role-btn" onclick="setAccessLevel('manager')">
          <span class="role-icon">üìã</span>
          <div class="role-info"><div class="role-name">Manager</div><div class="role-desc">Access manager checkup forms</div></div>
        </button>
        <button class="role-btn" onclick="setAccessLevel('admin')">
          <span class="role-icon">üîë</span>
          <div class="role-info"><div class="role-name">Admin</div><div class="role-desc">Full access to all forms and admin reviews</div></div>
        </button>
      </div>
    </div>
  </div>

  <script>
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       ROSOIDEAE Staff Portal ‚Äî Questionnaire Platform
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
    function generateId() {
      return 'roso_' + Date.now().toString(36) + '_' + Math.random().toString(36).slice(2, 8);
    }
    function escapeHtml(text) {
      var d = document.createElement('div');
      d.appendChild(document.createTextNode(text));
      return d.innerHTML;
    }
    function timeAgo(ts) {
      var diff = Date.now() - ts;
      var mins = Math.floor(diff / 60000);
      if (mins < 1) return 'just now';
      if (mins < 60) return mins + 'm ago';
      var hrs = Math.floor(mins / 60);
      if (hrs < 24) return hrs + 'h ago';
      var days = Math.floor(hrs / 24);
      if (days < 30) return days + 'd ago';
      return new Date(ts).toLocaleDateString();
    }

    // ‚îÄ‚îÄ Storage ‚îÄ‚îÄ
    function loadData(key, fallback) {
      try { return JSON.parse(localStorage.getItem(key)) || fallback; }
      catch (e) { return fallback; }
    }
    function saveData(key, data) { localStorage.setItem(key, JSON.stringify(data)); }

    function loadForms() { return loadData('roso_forms', []); }
    function saveForms(f) { saveData('roso_forms', f); }
    function loadSubmissions() { return loadData('roso_submissions', []); }
    function saveSubmissions(s) { saveData('roso_submissions', s); }

    // ‚îÄ‚îÄ Form Types & Icons ‚îÄ‚îÄ
    var FORM_TYPES = {
      'Team Checkup': { icon: 'üìã', css: 'checkup' },
      'Admin Review': { icon: 'üîç', css: 'admin' },
      'Staff Application': { icon: 'üìù', css: 'application' },
      'Survey': { icon: 'üìä', css: 'survey' }
    };

    // ‚îÄ‚îÄ Access Level System ‚îÄ‚îÄ
    var currentAccessLevel = loadData('roso_access_level', null);

    function setAccessLevel(level) {
      currentAccessLevel = level;
      saveData('roso_access_level', level);
      document.getElementById('access-modal').style.display = 'none';
      updateNavForAccess();
      navigateTo('dashboard');
    }

    function showAccessModal() {
      document.getElementById('access-modal').style.display = 'flex';
    }

    function updateNavForAccess() {
      var navForms = document.getElementById('nav-forms');
      var navApps = document.getElementById('nav-applications');
      var navSubs = document.getElementById('nav-submissions');
      if (currentAccessLevel === 'public') {
        navForms.classList.add('hidden');
      } else {
        navForms.classList.remove('hidden');
      }
      navApps.classList.remove('hidden');
      navSubs.classList.remove('hidden');
    }

    function getAccessibleForms(forms) {
      if (currentAccessLevel === 'admin') return forms;
      if (currentAccessLevel === 'manager') {
        return forms.filter(function(f) { return f.type === 'Team Checkup' || f.type === 'Staff Application' || f.type === 'Survey'; });
      }
      // public
      return forms.filter(function(f) { return f.type === 'Staff Application'; });
    }

    // ‚îÄ‚îÄ Seed Data ‚îÄ‚îÄ
    function seedForms() {
      var forms = loadForms();
      if (forms.length > 0) return;

      var seed = [
        {
          id: generateId(), type: 'Team Checkup', title: 'Manager 1-on-1 Checkup Template',
          description: 'Template for managers conducting 1-on-1 checkups with team members. Focuses on individual growth, satisfaction, and feedback.',
          createdBy: 'HR Director', createdAt: Date.now() - 345600000,
          questions: [
            { id: generateId(), type: 'text', text: 'Team member name:', required: true },
            { id: generateId(), type: 'rating', text: 'How is this team member performing overall?', hint: '1 = Below expectations, 5 = Exceeding expectations', required: true, max: 5 },
            { id: generateId(), type: 'choice', text: 'Engagement level:', required: true, options: ['Highly engaged', 'Engaged', 'Neutral', 'Disengaged', 'At risk of leaving'] },
            { id: generateId(), type: 'textarea', text: 'Key strengths observed:', hint: 'List specific behaviors, accomplishments, and positive impacts this member has had.', required: true },
            { id: generateId(), type: 'textarea', text: 'Areas for improvement or growth:', hint: 'Be constructive and include specific suggestions.', required: false },
            { id: generateId(), type: 'yesno', text: 'Does this team member need additional support or resources?', required: true },
            { id: generateId(), type: 'textarea', text: 'Action items from this checkup:', hint: 'Include deadlines and ownership for each item.', required: true },
            { id: generateId(), type: 'rating', text: 'How well does this member collaborate with others?', hint: '1 = Rarely collaborates, 5 = Highly collaborative', required: true, max: 5 },
            { id: generateId(), type: 'textarea', text: 'What goals should be set for the next review period?', required: true }
          ]
        },
        {
          id: generateId(), type: 'Admin Review', title: 'Monthly Admin Director Checkup',
          description: 'Monthly administrative review completed by admin directors. Evaluates department health, compliance, and strategic alignment.',
          createdBy: 'Senior Director', createdAt: Date.now() - 259200000,
          questions: [
            { id: generateId(), type: 'choice', text: 'Department status overall:', required: true, options: ['On Track', 'Minor Issues', 'Needs Attention', 'Critical'] },
            { id: generateId(), type: 'rating', text: 'Rate the department\'s operational efficiency.', hint: '1 = Needs major improvement, 5 = Highly efficient', required: true, max: 5 },
            { id: generateId(), type: 'yesno', text: 'Are all compliance requirements being met?', required: true },
            { id: generateId(), type: 'textarea', text: 'Summarize any compliance gaps or risks.', hint: 'Detail each gap, its severity, and proposed resolution.', required: false },
            { id: generateId(), type: 'textarea', text: 'Key achievements this month.', hint: 'Include metrics and tangible outcomes.', required: true },
            { id: generateId(), type: 'rating', text: 'Rate cross-team collaboration.', hint: '1 = Siloed, 5 = Highly collaborative', required: true, max: 5 },
            { id: generateId(), type: 'textarea', text: 'Strategic priorities for next month.', required: true },
            { id: generateId(), type: 'text', text: 'Budget or resource concerns?', required: false },
            { id: generateId(), type: 'choice', text: 'How would you rate staff retention in your department?', required: true, options: ['Excellent ‚Äî no turnover concerns', 'Good ‚Äî minor attrition', 'Fair ‚Äî some concerning departures', 'Poor ‚Äî significant turnover'] },
            { id: generateId(), type: 'textarea', text: 'What process improvements would you recommend?', hint: 'Think about bottlenecks, communication gaps, and tooling.', required: true }
          ]
        },
        {
          id: generateId(), type: 'Staff Application', title: 'Admin Application ‚Äî Esports Moderation',
          description: 'Apply to join the Admin team. We are looking for experienced moderators who understand esports communities, player behavior, and can enforce policies fairly and consistently.',
          createdBy: 'Admin Team', createdAt: Date.now() - 432000000,
          questions: [
            { id: generateId(), type: 'text', text: 'What is your Discord username and any other relevant handles?', required: true },
            { id: generateId(), type: 'text', text: 'How long have you been involved in esports communities?', required: true },
            { id: generateId(), type: 'textarea', text: 'Describe your previous moderation experience in esports or gaming communities.', hint: 'Include community names, your role, size of the community, and duration.', required: true },
            { id: generateId(), type: 'textarea', text: 'A player is accusing another of stream sniping during a competitive match, and the chat is becoming toxic. How do you handle this situation?', hint: 'Walk us through your step-by-step approach, including how you de-escalate, investigate, and communicate a resolution.', required: true },
            { id: generateId(), type: 'textarea', text: 'You discover that a well-known community figure is subtly breaking rules (e.g., soft-griefing, passive toxicity). Their fans defend them. What do you do?', hint: 'We want to see your ability to enforce rules impartially regardless of community status.', required: true },
            { id: generateId(), type: 'choice', text: 'Which moderation philosophy resonates most with you?', required: true, options: ['Prevention ‚Äî proactive community guidelines and education', 'Enforcement ‚Äî clear rules and consistent consequences', 'Restorative ‚Äî focus on rehabilitation and second chances', 'Balanced ‚Äî adapt approach based on the situation'] },
            { id: generateId(), type: 'textarea', text: 'How do you stay neutral and avoid burnout when moderating heated esports discussions or drama?', required: true },
            { id: generateId(), type: 'textarea', text: 'An organized group is coordinating off-platform to brigade the community chat during a live tournament. How do you identify and respond to this?', hint: 'Consider tools, escalation paths, and communication strategies.', required: true },
            { id: generateId(), type: 'rating', text: 'Rate your familiarity with moderation tools (Discord bots, Twitch mod tools, anti-cheat reporting systems, etc.).', hint: '1 = Beginner, 5 = Expert', required: true, max: 5 },
            { id: generateId(), type: 'choice', text: 'What timezone are you in?', required: true, options: ['UTC-8 to UTC-5 (Americas)', 'UTC-1 to UTC+2 (Europe/Africa)', 'UTC+3 to UTC+5.5 (Middle East/South Asia)', 'UTC+6 to UTC+12 (East Asia/Oceania)'] },
            { id: generateId(), type: 'rating', text: 'How many hours per week can you dedicate to moderation?', hint: '1 = 1-5 hrs, 2 = 5-10 hrs, 3 = 10-15 hrs, 4 = 15-20 hrs, 5 = 20+ hrs', required: true, max: 5 },
            { id: generateId(), type: 'textarea', text: 'What does a healthy esports community look like to you, and what role does moderation play in achieving that?', required: true },
            { id: generateId(), type: 'yesno', text: 'Are you willing to attend weekly admin sync meetings and participate in policy reviews?', required: true },
            { id: generateId(), type: 'textarea', text: 'Is there anything else you want us to know about you or your approach to moderation?', required: false }
          ]
        },
        {
          id: generateId(), type: 'Staff Application', title: 'Social Application ‚Äî Content & Media',
          description: 'Apply to join the Social team. We need creative individuals skilled in social media management, video editing, graphic design, and content strategy to grow the Rosoideae brand.',
          createdBy: 'Admin Team', createdAt: Date.now() - 518400000,
          questions: [
            { id: generateId(), type: 'text', text: 'What is your name/username and your social media handles?', required: true },
            { id: generateId(), type: 'choice', text: 'Which area of social media are you most experienced in?', required: true, options: ['Content creation (graphics, thumbnails, banners)', 'Video editing (highlights, montages, recaps)', 'Social media management (posting, scheduling, engagement)', 'Copywriting & branding', 'All of the above'] },
            { id: generateId(), type: 'textarea', text: 'Tell us about your experience with social media or content creation.', hint: 'Include platforms you\'ve managed, follower counts, engagement metrics, or portfolio links.', required: true },
            { id: generateId(), type: 'textarea', text: 'What editing software and design tools are you proficient in?', hint: 'E.g., Premiere Pro, After Effects, Photoshop, Canva, CapCut, DaVinci Resolve, Figma, etc.', required: true },
            { id: generateId(), type: 'textarea', text: 'How would you approach growing Rosoideae\'s presence on social media from the ground up?', hint: 'Include platform priorities, content pillars, posting frequency, and engagement strategy.', required: true },
            { id: generateId(), type: 'textarea', text: 'Describe a piece of content you\'ve created that you\'re proud of. What made it successful?', hint: 'Link it if possible, or describe the concept, execution, and results.', required: true },
            { id: generateId(), type: 'choice', text: 'How familiar are you with esports content trends?', required: true, options: ['Very familiar ‚Äî I follow esports closely and consume/create content daily', 'Somewhat familiar ‚Äî I keep up with major events and trends', 'Slightly familiar ‚Äî I know the basics but I\'m eager to learn', 'New to esports ‚Äî but I have strong social media skills'] },
            { id: generateId(), type: 'textarea', text: 'A tournament just ended with an exciting finals. You need to produce a social media recap within 2 hours. Walk us through your process.', hint: 'Consider what content formats you\'d create, which platforms you\'d prioritize, and how you\'d capture the hype.', required: true },
            { id: generateId(), type: 'rating', text: 'Rate your video editing skills.', hint: '1 = Basic cuts only, 5 = Advanced motion graphics and effects', required: true, max: 5 },
            { id: generateId(), type: 'rating', text: 'Rate your graphic design skills.', hint: '1 = Basic, 5 = Professional-level design', required: true, max: 5 },
            { id: generateId(), type: 'text', text: 'Link your portfolio, social accounts, or any relevant work samples:', hint: 'Provide URLs separated by commas.', required: false },
            { id: generateId(), type: 'rating', text: 'How many hours per week can you dedicate to content creation?', hint: '1 = 1-5 hrs, 2 = 5-10 hrs, 3 = 10-15 hrs, 4 = 15-20 hrs, 5 = 20+ hrs', required: true, max: 5 },
            { id: generateId(), type: 'yesno', text: 'Are you comfortable working under tight deadlines during live events?', required: true },
            { id: generateId(), type: 'textarea', text: 'What unique creative vision would you bring to the Rosoideae brand?', required: true }
          ]
        },
        {
          id: generateId(), type: 'Staff Application', title: 'Tournament Application ‚Äî Production & Casting',
          description: 'Apply to join the Tournament team. We are looking for passionate individuals to help with tournament production, casting, event coordination, and broadcast quality for events hosted by Rosoideae.',
          createdBy: 'Admin Team', createdAt: Date.now() - 604800000,
          questions: [
            { id: generateId(), type: 'text', text: 'What is your name/username and any relevant platform handles?', required: true },
            { id: generateId(), type: 'choice', text: 'Which tournament role are you most interested in?', required: true, options: ['Caster / Commentator', 'Producer / Director', 'Observer / Camera Operator', 'Tournament Organizer / Admin', 'Broadcast Technician (OBS, overlays, transitions)', 'Multiple roles ‚Äî I\'m versatile'] },
            { id: generateId(), type: 'textarea', text: 'Describe your experience with tournament production, casting, or esports events.', hint: 'Include event names, your specific role, team size, and viewership if applicable.', required: true },
            { id: generateId(), type: 'textarea', text: 'You\'re casting a live match and the stream goes down for 3 minutes mid-round. How do you handle the situation when the stream comes back?', hint: 'Consider viewer experience, catching up on missed action, and maintaining energy.', required: true },
            { id: generateId(), type: 'textarea', text: 'A team fails to show up for their scheduled match in a bracket tournament. Walk us through how you\'d handle this as a tournament admin.', hint: 'Consider rules enforcement, communication with teams, bracket adjustments, and viewer/audience communication.', required: true },
            { id: generateId(), type: 'choice', text: 'What production software are you familiar with?', required: true, options: ['OBS Studio / Streamlabs', 'vMix', 'Wirecast', 'Multiple professional tools', 'I\'m willing to learn'] },
            { id: generateId(), type: 'textarea', text: 'If you were to produce a Rosoideae-branded tournament from scratch, describe your ideal broadcast setup.', hint: 'Think about overlays, transitions, camera angles, audio mixing, branding elements, and viewer engagement features.', required: true },
            { id: generateId(), type: 'rating', text: 'Rate your public speaking / casting ability.', hint: '1 = Nervous / new to it, 5 = Confident and experienced on-air talent', required: true, max: 5 },
            { id: generateId(), type: 'textarea', text: 'What makes a great esports broadcast in your opinion? Name a broadcast you admire and explain why.', required: true },
            { id: generateId(), type: 'choice', text: 'What timezone are you in?', required: true, options: ['UTC-8 to UTC-5 (Americas)', 'UTC-1 to UTC+2 (Europe/Africa)', 'UTC+3 to UTC+5.5 (Middle East/South Asia)', 'UTC+6 to UTC+12 (East Asia/Oceania)'] },
            { id: generateId(), type: 'rating', text: 'How many hours per week can you dedicate to tournament work?', hint: '1 = 1-5 hrs, 2 = 5-10 hrs, 3 = 10-15 hrs, 4 = 15-20 hrs, 5 = 20+ hrs', required: true, max: 5 },
            { id: generateId(), type: 'yesno', text: 'Are you available for weekend events and flexible scheduling around tournament dates?', required: true },
            { id: generateId(), type: 'textarea', text: 'How would you handle a dispute between two teams during a live, broadcasted match regarding a controversial play?', hint: 'Consider the balance between fair ruling, broadcast flow, and audience experience.', required: true },
            { id: generateId(), type: 'text', text: 'Link any VODs, clips, or portfolio of your casting/production work:', required: false },
            { id: generateId(), type: 'textarea', text: 'Anything else you\'d like us to know about your passion for esports production?', required: false }
          ]
        },
        {
          id: generateId(), type: 'Survey', title: 'Q1 Team Satisfaction Survey',
          description: 'Anonymous quarterly survey to gauge team satisfaction, work-life balance, and suggestions for improvement.',
          createdBy: 'HR', createdAt: Date.now() - 86400000,
          questions: [
            { id: generateId(), type: 'rating', text: 'Overall, how satisfied are you with your role?', hint: '1 = Very dissatisfied, 5 = Very satisfied', required: true, max: 5 },
            { id: generateId(), type: 'rating', text: 'How would you rate work-life balance?', required: true, max: 5 },
            { id: generateId(), type: 'choice', text: 'Do you feel recognized for your contributions?', required: true, options: ['Always', 'Often', 'Sometimes', 'Rarely', 'Never'] },
            { id: generateId(), type: 'yesno', text: 'Would you recommend this organization to a friend?', required: true },
            { id: generateId(), type: 'textarea', text: 'What could we improve?', required: false },
            { id: generateId(), type: 'textarea', text: 'Any other feedback or suggestions?', required: false }
          ]
        }
      ];

      saveForms(seed);
    }

    // ‚îÄ‚îÄ State ‚îÄ‚îÄ
    var currentView = 'dashboard';
    var currentFormId = null;
    var currentSubId = null;
    var currentAnswers = {};
    var formsFilter = 'all';
    var subsFilter = 'all';
    var fillSource = 'forms'; // tracks where fill was opened from

    // ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ
    var views = ['dashboard', 'forms', 'applications', 'fill', 'submissions', 'sub-detail'];
    var navIds = ['nav-dashboard', 'nav-forms', 'nav-applications', 'nav-submissions'];

    function navigateTo(view, data) {
      views.forEach(function(v) {
        document.getElementById('view-' + v).classList.add('hidden');
      });
      navIds.forEach(function(id) {
        document.getElementById(id).classList.remove('active');
      });
      currentView = view;

      if (view === 'dashboard') {
        document.getElementById('view-dashboard').classList.remove('hidden');
        document.getElementById('nav-dashboard').classList.add('active');
        renderDashboard();
      } else if (view === 'forms') {
        document.getElementById('view-forms').classList.remove('hidden');
        document.getElementById('nav-forms').classList.add('active');
        renderFormsPage();
      } else if (view === 'applications') {
        document.getElementById('view-applications').classList.remove('hidden');
        document.getElementById('nav-applications').classList.add('active');
        renderApplicationsPage();
      } else if (view === 'fill') {
        currentFormId = data;
        currentAnswers = {};
        document.getElementById('view-fill').classList.remove('hidden');
        renderFillView();
      } else if (view === 'submissions') {
        document.getElementById('view-submissions').classList.remove('hidden');
        document.getElementById('nav-submissions').classList.add('active');
        renderSubmissionsPage();
      } else if (view === 'sub-detail') {
        currentSubId = data;
        document.getElementById('view-sub-detail').classList.remove('hidden');
        document.getElementById('nav-submissions').classList.add('active');
        renderSubDetail();
      }
      window.scrollTo(0, 0);
    }

    function goBackFromFill() {
      if (fillSource === 'applications') { navigateTo('applications'); }
      else if (fillSource === 'dashboard') { navigateTo('dashboard'); }
      else { navigateTo('forms'); }
    }

    // ‚îÄ‚îÄ Dashboard ‚îÄ‚îÄ
    function renderDashboard() {
      var allForms = loadForms();
      var forms = getAccessibleForms(allForms);
      var subs = loadSubmissions();
      var checkups = forms.filter(function(f) { return f.type === 'Team Checkup' || f.type === 'Admin Review'; });
      var apps = forms.filter(function(f) { return f.type === 'Staff Application'; });

      // Stats
      document.getElementById('dash-stats').innerHTML =
        '<div class="stat-card"><div class="stat-label">Total Forms</div><div class="stat-value purple">' + forms.length + '</div></div>'
        + '<div class="stat-card"><div class="stat-label">Your Submissions</div><div class="stat-value green">' + subs.length + '</div></div>'
        + '<div class="stat-card"><div class="stat-label">Checkup Forms</div><div class="stat-value amber">' + checkups.length + '</div></div>'
        + '<div class="stat-card"><div class="stat-label">Open Applications</div><div class="stat-value blue">' + apps.length + '</div></div>';

      // Form count badge
      document.getElementById('dash-form-count').textContent = forms.length;

      // Available forms (show first 4)
      var shown = forms.slice(0, 4);
      document.getElementById('dash-forms').innerHTML = renderFormCards(shown, 'dashboard');

      // Recent submissions
      var recent = subs.slice(-3).reverse();
      if (recent.length === 0) {
        document.getElementById('dash-recent-subs').innerHTML = '<div class="empty-state"><div class="empty-icon">üì≠</div><p>No submissions yet. Start by filling out a form!</p></div>';
      } else {
        document.getElementById('dash-recent-subs').innerHTML = renderSubmissionCards(recent);
      }
    }

    // ‚îÄ‚îÄ Form Cards Renderer ‚îÄ‚îÄ
    function renderFormCards(forms, source) {
      if (forms.length === 0) {
        return '<div class="empty-state"><div class="empty-icon">üìã</div><p>No forms available in this category.</p></div>';
      }
      var html = '';
      forms.forEach(function(f, i) {
        var meta = FORM_TYPES[f.type] || { icon: 'üìÑ', css: 'checkup' };
        html += '<div class="form-card" data-form-id="' + escapeHtml(f.id) + '" data-source="' + source + '" style="animation-delay:' + (i * 0.05) + 's">'
          + '<div class="fc-icon ' + meta.css + '">' + meta.icon + '</div>'
          + '<h3>' + escapeHtml(f.title) + '</h3>'
          + '<div class="fc-desc">' + escapeHtml(f.description) + '</div>'
          + '<div class="fc-footer">'
            + '<span class="fc-tag ' + meta.css + '">' + escapeHtml(f.type) + '</span>'
            + '<span class="fc-questions">' + f.questions.length + ' questions</span>'
          + '</div>'
          + '</div>';
      });
      return html;
    }

    // ‚îÄ‚îÄ Forms Page ‚îÄ‚îÄ
    function renderFormsPage() {
      var allForms = loadForms();
      var forms = getAccessibleForms(allForms);
      var nonAppForms = forms.filter(function(f) { return f.type !== 'Staff Application'; });
      var types = ['all'];
      if (currentAccessLevel === 'admin') { types.push('Team Checkup', 'Admin Review', 'Survey'); }
      else if (currentAccessLevel === 'manager') { types.push('Team Checkup', 'Survey'); }

      // Tabs
      var tabHtml = '';
      types.forEach(function(t) {
        var label = t === 'all' ? 'All' : t;
        var count = t === 'all' ? nonAppForms.length : nonAppForms.filter(function(f) { return f.type === t; }).length;
        tabHtml += '<button class="tab-btn' + (formsFilter === t ? ' active' : '') + '" data-forms-tab="' + t + '">' + label + ' (' + count + ')</button>';
      });
      document.getElementById('forms-tabs').innerHTML = tabHtml;

      // Filtered forms
      var filtered = formsFilter === 'all' ? nonAppForms : nonAppForms.filter(function(f) { return f.type === formsFilter; });
      document.getElementById('forms-list').innerHTML = renderFormCards(filtered, 'forms');
    }

    // ‚îÄ‚îÄ Applications Page ‚îÄ‚îÄ
    function renderApplicationsPage() {
      var allForms = loadForms();
      var forms = getAccessibleForms(allForms);
      var appForms = forms.filter(function(f) { return f.type === 'Staff Application'; });
      document.getElementById('applications-list').innerHTML = renderFormCards(appForms, 'applications');
    }

    // ‚îÄ‚îÄ Fill Form View ‚îÄ‚îÄ
    function renderFillView() {
      var forms = loadForms();
      var form = forms.find(function(f) { return f.id === currentFormId; });
      if (!form) { navigateTo('dashboard'); return; }

      var meta = FORM_TYPES[form.type] || { icon: 'üìÑ', css: 'checkup' };

      // Header
      document.getElementById('fill-header').innerHTML =
        '<h2>' + escapeHtml(form.title) + '</h2>'
        + '<div class="fill-desc">' + escapeHtml(form.description) + '</div>'
        + '<div class="fill-meta">'
          + '<div class="fill-meta-item"><span class="fc-tag ' + meta.css + '">' + escapeHtml(form.type) + '</span></div>'
          + '<div class="fill-meta-item">üìã ' + form.questions.length + ' questions</div>'
          + '<div class="fill-meta-item">‚úçÔ∏è Created by ' + escapeHtml(form.createdBy) + '</div>'
        + '</div>';

      updateProgress(form);

      // Questions
      var qHtml = '';
      form.questions.forEach(function(q, i) {
        qHtml += '<div class="question-card" style="animation-delay:' + (i * 0.05) + 's">'
          + '<div class="q-number">Question ' + (i + 1) + ' of ' + form.questions.length + '</div>'
          + '<div class="q-text">' + escapeHtml(q.text) + (q.required ? '<span class="q-required">*</span>' : '') + '</div>'
          + (q.hint ? '<div class="q-hint">' + escapeHtml(q.hint) + '</div>' : '')
          + renderQuestionInput(q)
          + '</div>';
      });
      document.getElementById('fill-questions').innerHTML = qHtml;

      // Submit actions
      document.getElementById('fill-actions').innerHTML =
        '<button class="btn btn-primary" id="submit-form-btn">Submit Response</button>'
        + '<button class="btn btn-secondary" onclick="goBackFromFill()">Cancel</button>';
    }

    function renderQuestionInput(q) {
      var val = currentAnswers[q.id] || '';
      if (q.type === 'text') {
        return '<input class="form-input" data-qid="' + escapeHtml(q.id) + '" data-qtype="text" placeholder="Your answer..." value="' + escapeHtml(val) + '" maxlength="500" />';
      }
      if (q.type === 'textarea') {
        return '<textarea class="form-textarea" data-qid="' + escapeHtml(q.id) + '" data-qtype="textarea" placeholder="Your answer..." maxlength="3000">' + escapeHtml(val) + '</textarea>';
      }
      if (q.type === 'choice') {
        var html = '<div class="choice-group">';
        (q.options || []).forEach(function(opt) {
          var selected = val === opt ? ' selected' : '';
          html += '<div class="choice-option' + selected + '" data-qid="' + escapeHtml(q.id) + '" data-value="' + escapeHtml(opt) + '">'
            + '<div class="choice-radio"></div>'
            + '<span class="choice-label">' + escapeHtml(opt) + '</span>'
            + '</div>';
        });
        html += '</div>';
        return html;
      }
      if (q.type === 'rating') {
        var max = q.max || 5;
        var html = '<div class="rating-group">';
        for (var i = 1; i <= max; i++) {
          var selected = val === String(i) ? ' selected' : '';
          html += '<button class="rating-btn' + selected + '" data-qid="' + escapeHtml(q.id) + '" data-value="' + i + '">' + i + '</button>';
        }
        html += '</div>';
        return html;
      }
      if (q.type === 'yesno') {
        var yesSelected = val === 'Yes' ? ' selected-yes' : '';
        var noSelected = val === 'No' ? ' selected-no' : '';
        return '<div class="yesno-group">'
          + '<button class="yesno-btn' + yesSelected + '" data-qid="' + escapeHtml(q.id) + '" data-value="Yes">Yes</button>'
          + '<button class="yesno-btn' + noSelected + '" data-qid="' + escapeHtml(q.id) + '" data-value="No">No</button>'
          + '</div>';
      }
      return '<input class="form-input" data-qid="' + escapeHtml(q.id) + '" data-qtype="text" placeholder="Your answer..." />';
    }

    function updateProgress(form) {
      var total = form.questions.length;
      var answered = 0;
      form.questions.forEach(function(q) {
        if (currentAnswers[q.id] && currentAnswers[q.id].trim()) answered++;
      });
      var pct = total > 0 ? Math.round((answered / total) * 100) : 0;
      document.getElementById('fill-progress').innerHTML =
        '<div class="progress-info"><span>' + answered + ' of ' + total + ' answered</span><span>' + pct + '%</span></div>'
        + '<div class="progress-track"><div class="progress-fill" style="width:' + pct + '%"></div></div>';
    }

    // ‚îÄ‚îÄ Submit Form ‚îÄ‚îÄ
    function handleSubmitForm() {
      var forms = loadForms();
      var form = forms.find(function(f) { return f.id === currentFormId; });
      if (!form) return;

      // Validate required fields
      var missing = [];
      form.questions.forEach(function(q, i) {
        if (q.required && (!currentAnswers[q.id] || !currentAnswers[q.id].trim())) {
          missing.push(i + 1);
        }
      });
      if (missing.length > 0) {
        showToast('Please answer required questions: ' + missing.join(', '), false);
        return;
      }

      // Build submission
      var answers = form.questions.map(function(q) {
        return { questionId: q.id, questionText: q.text, questionType: q.type, answer: currentAnswers[q.id] || '' };
      });
      var submission = {
        id: generateId(),
        formId: form.id,
        formTitle: form.title,
        formType: form.type,
        submittedAt: Date.now(),
        status: 'completed',
        answers: answers
      };

      var subs = loadSubmissions();
      subs.push(submission);
      saveSubmissions(subs);

      currentAnswers = {};
      showToast('Response submitted successfully!', true);
      navigateTo('submissions');
    }

    // ‚îÄ‚îÄ Submissions Page ‚îÄ‚îÄ
    function renderSubmissionsPage() {
      var subs = loadSubmissions();
      var types = ['all', 'Team Checkup', 'Admin Review', 'Staff Application', 'Survey'];

      // Tabs
      var tabHtml = '';
      types.forEach(function(t) {
        var label = t === 'all' ? 'All' : t;
        var count = t === 'all' ? subs.length : subs.filter(function(s) { return s.formType === t; }).length;
        tabHtml += '<button class="tab-btn' + (subsFilter === t ? ' active' : '') + '" data-subs-tab="' + t + '">' + label + ' (' + count + ')</button>';
      });
      document.getElementById('subs-tabs').innerHTML = tabHtml;

      var filtered = subsFilter === 'all' ? subs : subs.filter(function(s) { return s.formType === subsFilter; });
      filtered = filtered.slice().reverse();

      if (filtered.length === 0) {
        document.getElementById('subs-list').innerHTML = '<div class="empty-state"><div class="empty-icon">üì≠</div><p>No submissions found. Go fill out a form!</p><button class="btn btn-primary" onclick="navigateTo(\'forms\')">Browse Forms</button></div>';
      } else {
        document.getElementById('subs-list').innerHTML = renderSubmissionCards(filtered);
      }
    }

    function renderSubmissionCards(subs) {
      var html = '<div class="submissions-list">';
      subs.forEach(function(s, i) {
        var meta = FORM_TYPES[s.formType] || { icon: 'üìÑ', css: 'checkup' };
        html += '<div class="submission-card" data-sub-id="' + escapeHtml(s.id) + '" style="animation-delay:' + (i * 0.04) + 's">'
          + '<div class="sub-info">'
            + '<div class="sub-form-name">' + meta.icon + ' ' + escapeHtml(s.formTitle) + '</div>'
            + '<div class="sub-meta"><span>Submitted ' + timeAgo(s.submittedAt) + '</span><span>' + s.answers.length + ' answers</span></div>'
          + '</div>'
          + '<span class="sub-status ' + s.status + '">' + s.status + '</span>'
          + '</div>';
      });
      html += '</div>';
      return html;
    }

    // ‚îÄ‚îÄ Submission Detail ‚îÄ‚îÄ
    function renderSubDetail() {
      var subs = loadSubmissions();
      var sub = subs.find(function(s) { return s.id === currentSubId; });
      if (!sub) { navigateTo('submissions'); return; }

      var meta = FORM_TYPES[sub.formType] || { icon: 'üìÑ', css: 'checkup' };
      var html = '<div class="fill-header">'
        + '<h2>' + meta.icon + ' ' + escapeHtml(sub.formTitle) + '</h2>'
        + '<div class="fill-desc">Submitted ' + timeAgo(sub.submittedAt) + '</div>'
        + '<div class="fill-meta"><span class="fc-tag ' + meta.css + '">' + escapeHtml(sub.formType) + '</span><span class="sub-status ' + sub.status + '" style="margin-left:0.5rem">' + sub.status + '</span></div>'
        + '</div>';

      sub.answers.forEach(function(a, i) {
        var displayAnswer = a.answer ? escapeHtml(a.answer) : '<em style="color:var(--text-muted)">Not answered</em>';
        html += '<div class="answer-card" style="animation: fadeIn 0.3s ease backwards; animation-delay:' + (i * 0.04) + 's">'
          + '<div class="a-question">Q' + (i + 1) + '. ' + escapeHtml(a.questionText) + '</div>'
          + '<div class="a-value">' + displayAnswer + '</div>'
          + '</div>';
      });

      document.getElementById('sub-detail-content').innerHTML = html;
    }

    // ‚îÄ‚îÄ Toast ‚îÄ‚îÄ
    function showToast(msg, success) {
      var existing = document.querySelector('.toast');
      if (existing) existing.remove();
      var toast = document.createElement('div');
      toast.className = 'toast' + (success ? ' success' : '');
      toast.textContent = (success ? '‚úÖ ' : '‚ö†Ô∏è ') + msg;
      document.body.appendChild(toast);
      setTimeout(function() { toast.remove(); }, 3500);
    }

    // ‚îÄ‚îÄ Event Delegation ‚îÄ‚îÄ
    document.addEventListener('click', function(e) {
      var target = e.target;

      // Form card click ‚Üí fill
      var formCard = target.closest('[data-form-id]');
      if (formCard) {
        fillSource = formCard.getAttribute('data-source') || 'forms';
        navigateTo('fill', formCard.getAttribute('data-form-id'));
        return;
      }

      // Submission card click ‚Üí detail
      var subCard = target.closest('[data-sub-id]');
      if (subCard) {
        navigateTo('sub-detail', subCard.getAttribute('data-sub-id'));
        return;
      }

      // Choice option
      var choiceOpt = target.closest('.choice-option');
      if (choiceOpt) {
        var qid = choiceOpt.getAttribute('data-qid');
        var val = choiceOpt.getAttribute('data-value');
        currentAnswers[qid] = val;
        // Update UI
        choiceOpt.parentElement.querySelectorAll('.choice-option').forEach(function(el) { el.classList.remove('selected'); });
        choiceOpt.classList.add('selected');
        updateProgressFromDOM();
        return;
      }

      // Rating button
      var ratingBtn = target.closest('.rating-btn');
      if (ratingBtn) {
        var qid = ratingBtn.getAttribute('data-qid');
        var val = ratingBtn.getAttribute('data-value');
        currentAnswers[qid] = val;
        ratingBtn.parentElement.querySelectorAll('.rating-btn').forEach(function(el) { el.classList.remove('selected'); });
        ratingBtn.classList.add('selected');
        updateProgressFromDOM();
        return;
      }

      // Yes/No button
      var ynBtn = target.closest('.yesno-btn');
      if (ynBtn) {
        var qid = ynBtn.getAttribute('data-qid');
        var val = ynBtn.getAttribute('data-value');
        currentAnswers[qid] = val;
        ynBtn.parentElement.querySelectorAll('.yesno-btn').forEach(function(el) { el.classList.remove('selected-yes', 'selected-no'); });
        ynBtn.classList.add(val === 'Yes' ? 'selected-yes' : 'selected-no');
        updateProgressFromDOM();
        return;
      }

      // Submit form
      if (target.id === 'submit-form-btn' || target.closest('#submit-form-btn')) {
        collectTextAnswers();
        handleSubmitForm();
        return;
      }

      // Forms tab
      var fTab = target.closest('[data-forms-tab]');
      if (fTab) {
        formsFilter = fTab.getAttribute('data-forms-tab');
        renderFormsPage();
        return;
      }

      // Submissions tab
      var sTab = target.closest('[data-subs-tab]');
      if (sTab) {
        subsFilter = sTab.getAttribute('data-subs-tab');
        renderSubmissionsPage();
        return;
      }
    });

    // Collect text/textarea answers on input
    document.addEventListener('input', function(e) {
      var target = e.target;
      var qid = target.getAttribute('data-qid');
      if (qid) {
        currentAnswers[qid] = target.value;
        updateProgressFromDOM();
      }
    });

    function collectTextAnswers() {
      document.querySelectorAll('[data-qid][data-qtype]').forEach(function(el) {
        currentAnswers[el.getAttribute('data-qid')] = el.value;
      });
    }

    function updateProgressFromDOM() {
      var forms = loadForms();
      var form = forms.find(function(f) { return f.id === currentFormId; });
      if (form) updateProgress(form);
    }

    // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
    // Clear seed data to apply new forms
    if (!loadData('roso_forms_v2', false)) {
      saveData('roso_forms', []);
      saveData('roso_forms_v2', true);
    }
    seedForms();

    // Show access level modal if not set
    if (currentAccessLevel) {
      document.getElementById('access-modal').style.display = 'none';
      updateNavForAccess();
    }
    navigateTo('dashboard');
  </script>
</body>
</html>
